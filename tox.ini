[tox]
isolated_build = True
skipsdist = True

[testenv]
package = wheel
wheel_build_env = .pkg
commands =
  ruff: ruff format {posargs:.}
  ruff: ruff check --fix {posargs:.}
  mypy: mypy {posargs:.}
  test: pytest {posargs:.}
  ci: ruff format --diff .
  ci: ruff check --no-fix .
  ci: mypy .
  ci: pytest {posargs:.}

[testenv:ci_checks]
runner = uv-venv-lock-runner
extras =
  check
commands =
  uv run ruff format --diff .
  uv run ruff check --no-fix .
  uv run mypy .
  uv run strawberry export-schema phoenix.server.api.schema:schema --output app/schema.graphql

[testenv:ci_unit_tests_linux]
runner = uv-venv-lock-runner
extras =
  test
commands =
  uv run pytest -x -ra --run-postgres tests/unit

[testenv:ci_unit_tests_non_linux]
runner = uv-venv-lock-runner
extras =
  test
commands =
  uv run pytest -n auto -x -ra tests/unit

[testenv:ci_integration_tests]
runner = uv-venv-lock-runner
extras =
  test
commands =
  uv run pytest -n auto -x -ra tests/integration
